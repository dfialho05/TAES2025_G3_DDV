<!doctype html>
<html lang="pt">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Teste Timer e Bot - Jogo de Cartas</title>
        <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>
        <style>
            body {
                font-family: Arial, sans-serif;
                max-width: 1000px;
                margin: 0 auto;
                padding: 20px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: #333;
            }
            .container {
                background: white;
                padding: 20px;
                border-radius: 15px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            }
            h1 {
                text-align: center;
                color: #4a5568;
                margin-bottom: 30px;
            }
            .test-section {
                background: #f8f9fa;
                padding: 15px;
                border-radius: 10px;
                margin: 15px 0;
                border-left: 4px solid #007bff;
            }
            .timer-display {
                background: #e3f2fd;
                padding: 20px;
                border-radius: 10px;
                text-align: center;
                font-size: 24px;
                font-weight: bold;
                margin: 20px 0;
                border: 3px solid #2196f3;
            }
            .timer-display.warning {
                background: #fff3cd;
                border-color: #ffc107;
                color: #856404;
            }
            .timer-display.danger {
                background: #f8d7da;
                border-color: #dc3545;
                color: #721c24;
            }
            .bot-area {
                background: #f1f3f4;
                padding: 20px;
                border-radius: 10px;
                text-align: center;
                margin: 20px 0;
                border: 3px solid #6c757d;
            }
            .bot-card {
                display: inline-block;
                padding: 15px 25px;
                margin: 10px;
                background: #fff;
                border: 3px solid #6c757d;
                border-radius: 15px;
                font-weight: bold;
                font-size: 20px;
                min-width: 80px;
                text-align: center;
                transition: all 0.3s ease;
            }
            .bot-card.trump {
                background: #fff5b4;
                border-color: #ff6b6b;
                box-shadow: 0 0 15px rgba(255, 107, 107, 0.4);
            }
            .bot-card.empty {
                background: #f8f9fa;
                border: 2px dashed #dee2e6;
                color: #6c757d;
                font-style: italic;
            }
            .controls {
                display: flex;
                gap: 10px;
                margin: 20px 0;
                flex-wrap: wrap;
            }
            button {
                padding: 12px 20px;
                font-size: 16px;
                border: none;
                border-radius: 8px;
                cursor: pointer;
                transition: all 0.3s ease;
                flex: 1;
                min-width: 120px;
            }
            .btn-primary {
                background: #007bff;
                color: white;
            }
            .btn-primary:hover {
                background: #0056b3;
            }
            .btn-success {
                background: #28a745;
                color: white;
            }
            .btn-success:hover {
                background: #1e7e34;
            }
            .btn-warning {
                background: #ffc107;
                color: #212529;
            }
            .btn-warning:hover {
                background: #e0a800;
            }
            .log {
                height: 200px;
                overflow-y: scroll;
                background: #2d3748;
                color: #e2e8f0;
                padding: 15px;
                border-radius: 8px;
                font-family: 'Courier New', monospace;
                font-size: 13px;
                border: 1px solid #4a5568;
            }
            .status {
                padding: 10px;
                border-radius: 8px;
                margin: 10px 0;
                font-weight: bold;
                text-align: center;
            }
            .connected {
                background: #d4edda;
                color: #155724;
                border: 1px solid #c3e6cb;
            }
            .disconnected {
                background: #f8d7da;
                color: #721c24;
                border: 1px solid #f5c6cb;
            }
            .feature-demo {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 20px;
                margin: 20px 0;
            }
            @media (max-width: 768px) {
                .feature-demo {
                    grid-template-columns: 1fr;
                }
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>üß™ Teste Timer & Bot Card - Sistema Avan√ßado</h1>

            <div id="status" class="status disconnected">
                ‚ùå Desconectado do servidor
            </div>

            <div class="test-section">
                <h3>üéÆ Controles de Teste</h3>
                <div class="controls">
                    <button class="btn-primary" onclick="connectToServer()">
                        Conectar ao Servidor
                    </button>
                    <button class="btn-success" onclick="startTestGame()" id="startBtn" disabled>
                        Iniciar Teste
                    </button>
                    <button class="btn-warning" onclick="simulateTimeout()">
                        Simular Timeout
                    </button>
                </div>
            </div>

            <div class="feature-demo">
                <div class="test-section">
                    <h3>‚è±Ô∏è Timer de Jogadas (2 minutos)</h3>
                    <div id="timerDisplay" class="timer-display" style="display: none;">
                        Tempo restante: <span id="timeText">2:00</span>
                    </div>
                    <p><strong>Status:</strong> <span id="timerStatus">Aguardando in√≠cio do jogo</span></p>
                </div>

                <div class="test-section">
                    <h3>ü§ñ Visualiza√ß√£o do Bot</h3>
                    <div class="bot-area">
                        <div id="botCard" class="bot-card empty">
                            Aguardando bot...
                        </div>
                    </div>
                    <p><strong>Status:</strong> <span id="botStatus">Bot inativo</span></p>
                </div>
            </div>

            <div class="test-section">
                <h3>üìä Informa√ß√µes do Jogo</h3>
                <div id="gameInfo" style="display: none;">
                    <p><strong>ID do Jogo:</strong> <span id="gameId">-</span></p>
                    <p><strong>Trunfo:</strong> <span id="trump">-</span></p>
                    <p><strong>Vez atual:</strong> <span id="currentTurn">-</span></p>
                </div>
            </div>

            <div class="test-section">
                <h3>üìù Log de Eventos</h3>
                <div id="log" class="log"></div>
            </div>
        </div>

        <script>
            let socket = null;
            let gameId = null;
            let playerName = "TestPlayer";
            let timerInterval = null;
            let timeRemaining = 0;

            const log = (message, type = 'info') => {
                const logDiv = document.getElementById("log");
                const time = new Date().toLocaleTimeString();
                const color = type === 'error' ? '#ff6b6b' :
                             type === 'success' ? '#51cf66' :
                             type === 'warning' ? '#ffd43b' : '#74c0fc';
                logDiv.innerHTML += `<span style="color: ${color}">[${time}] ${message}</span><br>`;
                logDiv.scrollTop = logDiv.scrollHeight;
            };

            const updateStatus = (connected) => {
                const statusDiv = document.getElementById("status");
                if (connected) {
                    statusDiv.className = "status connected";
                    statusDiv.innerHTML = "‚úÖ Conectado ao servidor";
                } else {
                    statusDiv.className = "status disconnected";
                    statusDiv.innerHTML = "‚ùå Desconectado do servidor";
                }
            };

            const connectToServer = () => {
                log("üîå Iniciando conex√£o com o servidor...");

                socket = io("ws://localhost:3000");

                socket.on("connect", () => {
                    log("‚úÖ Conectado! Fazendo autentica√ß√£o...", 'success');
                    socket.emit("auth", { playerName });
                    updateStatus(true);
                });

                socket.on("authSuccess", (data) => {
                    log(`üéØ Autenticado como: ${data.playerName}`, 'success');
                    document.getElementById("startBtn").disabled = false;
                });

                socket.on("gameStarted", (data) => {
                    gameId = data.gameId;
                    log(`üéÆ Jogo iniciado! ID: ${gameId}`, 'success');
                    updateGameInfo(data.state);
                    document.getElementById("gameInfo").style.display = "block";
                });

                // Timer events
                socket.on("turnTimerStarted", (data) => {
                    if (data.player === playerName) {
                        log(`‚è±Ô∏è Timer iniciado! Voc√™ tem 2 minutos para jogar.`, 'warning');
                        startTimerDisplay(data.timeLimit);
                        document.getElementById("timerStatus").textContent = "Timer ativo - Sua vez!";
                    }
                });

                socket.on("turnTimerUpdate", (data) => {
                    if (data.player === playerName) {
                        updateTimerDisplay(data.timeRemaining);
                    }
                });

                socket.on("playerTimeout", (data) => {
                    if (data.player === playerName) {
                        log(`‚è∞ TIMEOUT! Jogada autom√°tica: ${data.autoPlayedCard}`, 'error');
                        clearTimerDisplay();
                        document.getElementById("timerStatus").textContent = "Timeout - Jogada autom√°tica executada";
                    }
                });

                // Bot events
                socket.on("botTurnStarted", (data) => {
                    log("ü§ñ Bot est√° pensando...");
                    setBotCard("thinking", "ü§î Pensando...");
                    document.getElementById("botStatus").textContent = "Bot pensando...";
                });

                socket.on("botCardPlayed", (data) => {
                    log(`ü§ñ Bot jogou: ${data.card}`, 'success');
                    setBotCard(data.card);
                    document.getElementById("botStatus").textContent = `Bot jogou: ${data.card}`;
                });

                socket.on("roundEnded", (data) => {
                    log(`üèÜ Rodada terminou! Vencedor: ${data.winner}`);
                    setTimeout(() => {
                        clearBotCard();
                        document.getElementById("botStatus").textContent = "Aguardando pr√≥xima jogada...";
                    }, 3000);
                });

                socket.on("gameEnded", (data) => {
                    log(`üéâ Jogo terminou! Vencedor: ${data.winner}`, 'success');
                    clearTimerDisplay();
                    clearBotCard();
                    document.getElementById("timerStatus").textContent = "Jogo finalizado";
                    document.getElementById("botStatus").textContent = "Jogo finalizado";
                });

                socket.on("disconnect", () => {
                    log("üîå Desconectado do servidor", 'error');
                    updateStatus(false);
                    document.getElementById("startBtn").disabled = true;
                    clearTimerDisplay();
                    clearBotCard();
                });

                socket.on("error", (error) => {
                    log(`‚ùå Erro: ${error.message}`, 'error');
                });
            };

            const startTestGame = () => {
                if (!socket || !socket.connected) {
                    log("‚ùå Conecte-se ao servidor primeiro!", 'error');
                    return;
                }

                log("üöÄ Iniciando jogo de teste...");
                socket.emit("startSingleplayerGame", {
                    playerName,
                    turnTime: 120 // 2 minutes
                });
            };

            const simulateTimeout = () => {
                if (!gameId) {
                    log("‚ùå Nenhum jogo ativo para simular timeout", 'error');
                    return;
                }
                log("‚ö†Ô∏è Simulando timeout... (aguarde 2 minutos ou jogue uma carta)", 'warning');
            };

            const updateGameInfo = (state) => {
                document.getElementById("gameId").textContent = gameId;
                document.getElementById("trump").textContent = state.trump;
                document.getElementById("currentTurn").textContent = state.currentTurn;
            };

            // Timer functions
            const startTimerDisplay = (timeLimit) => {
                timeRemaining = timeLimit;
                document.getElementById("timerDisplay").style.display = "block";
                updateTimerVisual();

                timerInterval = setInterval(() => {
                    timeRemaining -= 1000;
                    if (timeRemaining <= 0) {
                        clearTimerDisplay();
                    } else {
                        updateTimerVisual();
                    }
                }, 1000);
            };

            const updateTimerDisplay = (remaining) => {
                timeRemaining = remaining;
                updateTimerVisual();
            };

            const updateTimerVisual = () => {
                const minutes = Math.floor(timeRemaining / 60000);
                const seconds = Math.floor((timeRemaining % 60000) / 1000);
                const timeString = `${minutes}:${seconds.toString().padStart(2, '0')}`;

                document.getElementById("timeText").textContent = timeString;

                const timerElement = document.getElementById("timerDisplay");
                if (timeRemaining < 30000) {
                    timerElement.className = "timer-display danger";
                } else if (timeRemaining < 60000) {
                    timerElement.className = "timer-display warning";
                } else {
                    timerElement.className = "timer-display";
                }
            };

            const clearTimerDisplay = () => {
                if (timerInterval) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                }
                document.getElementById("timerDisplay").style.display = "none";
                document.getElementById("timerStatus").textContent = "Timer inativo";
            };

            // Bot card functions
            const setBotCard = (cardFace, customText = null) => {
                const botCardElement = document.getElementById("botCard");

                if (cardFace === "thinking") {
                    botCardElement.textContent = customText || "ü§î Pensando...";
                    botCardElement.className = "bot-card empty";
                } else {
                    botCardElement.textContent = cardFace;
                    botCardElement.className = "bot-card";

                    // Check if it's a trump card (simplified check)
                    if (cardFace && cardFace.includes('‚ô†') || cardFace.includes('‚ô£') ||
                        cardFace.includes('‚ô•') || cardFace.includes('‚ô¶')) {
                        // This is a simple check - in real game, you'd compare with trump suit
                        if (Math.random() > 0.7) { // 30% chance to simulate trump
                            botCardElement.classList.add("trump");
                        }
                    }
                }
            };

            const clearBotCard = () => {
                const botCardElement = document.getElementById("botCard");
                botCardElement.textContent = "Aguardando bot...";
                botCardElement.className = "bot-card empty";
            };

            // Initialize
            log("üéØ Sistema de teste carregado. Clique em 'Conectar ao Servidor' para iniciar.");
        </script>
    </body>
</html>
